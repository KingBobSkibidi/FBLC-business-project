<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title> Business Details | Locally </title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <h1 class="center_text">Business Details</h1>

    <div class="navbar">
        <a href="{{ url_for('index') }}">Explore</a>

        {% if session.get("user_id") %}
            <a href="{{ url_for('profile') }}">Profile</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        {% else %}
            <a href="{{ url_for('login') }}">Login</a>
            <a href="{{ url_for('register') }}">Register</a>
        {% endif %}
    </div>

    <main class="page details-view">
        <section class="card-grid one-column">
            <div class="card">
                <div class="card-photo">
                    Photo
                </div>
                <div class="card-body">
                    <h2 class="card-title">{{ business.name|title }}</h2>
                    <p><strong>Category:</strong> {{ business.category }}</p>
                    <p class="card-location">{{ business.location|title }}</p>
                    {% if rating_count > 0 %}
                        <p><strong>Rating:</strong> {{ "%.1f"|format(avg_rating) }}/5 ({{ rating_count }} rating{% if rating_count != 1 %}s{% endif %})</p>
                    {% else %}
                        <p><strong>Rating:</strong> Not rated yet</p>
                    {% endif %}
                    <p>{{ business.description }}</p>

                    {% if session.get("user_id") %}
                        <form method="post" action="{{ url_for('rate_business', business_id=business.id) }}">
                            <label for="rating"><strong>Your rating:</strong></label>
                            <select id="rating" name="rating" required>
                                <option value="" disabled {% if not user_rating %}selected{% endif %}>Select</option>
                                {% for n in range(1, 6) %}
                                    <option value="{{ n }}" {% if user_rating == n %}selected{% endif %}>{{ n }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit">Save rating</button>
                        </form>
                    {% else %}
                        <p><a href="{{ url_for('login') }}">Log in</a> to rate this business.</p>
                    {% endif %}
                </div>
            </div>
        </section>
    </main>
</body>

</html>
